<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>日历组件</title>
    <style>
        .ui-date-picker{
            position: absolute;
            width:240px;
            border:1px solid #ccc;
            font-size: 14px;
            font-family: seirf ,cursive,fantasy;
        }
        .ui-date-picker > .header{
            height:30px;
            line-height: 30px;
            text-align: center;
            background-color: #CA2B2B;
            color:#fff;
        }
        .ui-date-picker .caret-left{
            display: block;
            float: left;
            margin-left: 10px;
            margin-top: 6px;
            border-right:7px solid #fff;
            border-top: 7px solid transparent;
            border-bottom: 7px solid transparent;
            width: 0;
            height:0;
            cursor: pointer;
        }
        .ui-date-picker .caret-right{
            display: block;
            float: right;
            margin-right: 10px;
            margin-top: 6px;
            border-left:7px solid #fff;
            border-top: 7px solid transparent;
            border-bottom: 7px solid transparent;
            width: 0;
            height:0;
            cursor: pointer;
        }
        .ui-date-picker .panel{
            width:100%;
            text-align: center;
            background-color: #fff;
        }
        .ui-date-picker .panel th{
            line-height: 2;
        }
        .ui-date-picker .panle td{
            line-height: 1.2;
        }
        .ui-date-picker .pre-month,
        .ui-date-picker .next-month{
            color:#eee;
        }
        .ui-date-picker .cur-month{
            cursor: pointer;
        }
        .ui-date-picker .cur-month:hover{
            background-color: #ccc;
            color:#fff;
        }
        .ui-date-picker .cur-date{
            color: #CA2B2B;
        }
        .date-ipt{
            margin-left: 200px;

        }
    </style>
    <script src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.js"></script>
</head>
<body>
<input type="text" class="date-ipt" placeholder="有初始值" date-init="2016/02/15"><div class="ui-date-picker" style="position: absolute; left: 8px; top: 31px; display: none;"><div class="header"><span class="pre caret-left"></span> <span class="cur header-date">2016年2月</span> <span class="next caret-right"></span></div><table class="panel"><thead><tr><th>日</th><th>一</th><th>二</th><th>三</th><th>四</th><th>五</th><th>六</th></tr></thead><tbody><tr><td class="pre-month" data-date="2016/1/31">31</td><td class="cur-month" data-date="2016/2/1">1</td><td class="cur-month" data-date="2016/2/2">2</td><td class="cur-month" data-date="2016/2/3">3</td><td class="cur-month" data-date="2016/2/4">4</td><td class="cur-month" data-date="2016/2/5">5</td><td class="cur-month" data-date="2016/2/6">6</td></tr><tr><td class="cur-month" data-date="2016/2/7">7</td><td class="cur-month" data-date="2016/2/8">8</td><td class="cur-month" data-date="2016/2/9">9</td><td class="cur-month" data-date="2016/2/10">10</td><td class="cur-month" data-date="2016/2/11">11</td><td class="cur-month" data-date="2016/2/12">12</td><td class="cur-month" data-date="2016/2/13">13</td></tr><tr><td class="cur-month" data-date="2016/2/14">14</td><td class="cur-month cur-date" data-date="2016/2/15">15</td><td class="cur-month" data-date="2016/2/16">16</td><td class="cur-month" data-date="2016/2/17">17</td><td class="cur-month" data-date="2016/2/18">18</td><td class="cur-month" data-date="2016/2/19">19</td><td class="cur-month" data-date="2016/2/20">20</td></tr><tr><td class="cur-month" data-date="2016/2/21">21</td><td class="cur-month" data-date="2016/2/22">22</td><td class="cur-month" data-date="2016/2/23">23</td><td class="cur-month" data-date="2016/2/24">24</td><td class="cur-month" data-date="2016/2/25">25</td><td class="cur-month" data-date="2016/2/26">26</td><td class="cur-month" data-date="2016/2/27">27</td></tr><tr><td class="cur-month" data-date="2016/2/28">28</td><td class="cur-month" data-date="2016/2/29">29</td><td class="next-month" data-date="2016/3/1">1</td><td class="next-month" data-date="2016/3/2">2</td><td class="next-month" data-date="2016/3/3">3</td><td class="next-month" data-date="2016/3/4">4</td><td class="next-month" data-date="2016/3/5">5</td></tr></tbody></table></div>
<input type="text" class="date-ipt" placeholder="无初始值"><div class="ui-date-picker" style="position: absolute; left: 185.734px; top: 31px; display: none;"><div class="header"><span class="pre caret-left"></span> <span class="cur header-date">2018年2月</span> <span class="next caret-right"></span></div><table class="panel"><thead><tr><th>日</th><th>一</th><th>二</th><th>三</th><th>四</th><th>五</th><th>六</th></tr></thead><tbody><tr><td class="pre-month" data-date="2018/1/28">28</td><td class="pre-month" data-date="2018/1/29">29</td><td class="pre-month" data-date="2018/1/30">30</td><td class="pre-month" data-date="2018/1/31">31</td><td class="cur-month" data-date="2018/2/1">1</td><td class="cur-month" data-date="2018/2/2">2</td><td class="cur-month" data-date="2018/2/3">3</td></tr><tr><td class="cur-month" data-date="2018/2/4">4</td><td class="cur-month" data-date="2018/2/5">5</td><td class="cur-month" data-date="2018/2/6">6</td><td class="cur-month" data-date="2018/2/7">7</td><td class="cur-month" data-date="2018/2/8">8</td><td class="cur-month" data-date="2018/2/9">9</td><td class="cur-month" data-date="2018/2/10">10</td></tr><tr><td class="cur-month" data-date="2018/2/11">11</td><td class="cur-month" data-date="2018/2/12">12</td><td class="cur-month" data-date="2018/2/13">13</td><td class="cur-month" data-date="2018/2/14">14</td><td class="cur-month" data-date="2018/2/15">15</td><td class="cur-month" data-date="2018/2/16">16</td><td class="cur-month" data-date="2018/2/17">17</td></tr><tr><td class="cur-month" data-date="2018/2/18">18</td><td class="cur-month" data-date="2018/2/19">19</td><td class="cur-month" data-date="2018/2/20">20</td><td class="cur-month" data-date="2018/2/21">21</td><td class="cur-month" data-date="2018/2/22">22</td><td class="cur-month" data-date="2018/2/23">23</td><td class="cur-month" data-date="2018/2/24">24</td></tr><tr><td class="cur-month" data-date="2018/2/25">25</td><td class="cur-month" data-date="2018/2/26">26</td><td class="cur-month" data-date="2018/2/27">27</td><td class="cur-month" data-date="2018/2/28">28</td><td class="next-month" data-date="2018/3/1">1</td><td class="next-month" data-date="2018/3/2">2</td><td class="next-month" data-date="2018/3/3">3</td></tr></tbody></table></div>
<script>
    function DatePicker($target) {
        this.init($target);
        this.render();
        this.setData();
        this.bind();
    }
    DatePicker.prototype={
        init:function ($target) {
            this.$target=$target;
            if(this.isValidate($target.attr("date-init"))){
                this.date=new Date($target.attr("date-init"));
                this.watchDate=new Date($target.attr("date-init"));
            }else{
                this.date=new Date();
                this.watchDate=new Date();
            }
        },
        isValidate:function (date) {
            return new Date(date).toString()!=="Invalid Date";
        },
        render:function () {
            var tp1=["<div class='ui-date-picker' style='display: none'>",
                "<div class='header'>",
                "<span class='pre caret-left'></span>",
                " <span class='cur header-date'></span>",
                " <span class='next caret-right'></span>",
                "</div>",
                "<table class='panel'>",
                "<thead>",
                "<tr>",
                "<th>日</th>",
                "<th>一</th>",
                "<th>二</th>",
                "<th>三</th>",
                "<th>四</th>",
                "<th>五</th>",
                "<th>六</th>",
                "</tr>",
                "</thead>",
                "<tbody></tbody>",
                "</table>",
                "</div>"
            ].join("");
            this.$datepicker=$(tp1);
            this.$datepicker.insertAfter(this.$target).css({
                "position":"absolute",
                "left":this.$target.offset().left,
                "top":this.$target.offset().top+this.$target.outerHeight(true)
            })
        },
        setData:function () {
            this.$datepicker.find("tbody").html("");
            var firstDay=this.getFirstDay(this.watchDate),
                lastDay=this.getLastDay(this.watchDate);
            var dateArr=[];
            for(var i=firstDay.getDay();i>0;i--){
                var d=new Date(firstDay.getTime()-i*24*60*60*1000);
                dateArr.push({type:"pre",date:d});
            }
            for(var i=0;i<lastDay.getDate();i++){
                var d=new Date(firstDay.getTime()+i*24*60*60*1000);
                dateArr.push({type:"cur",date:d});
            }
            for(var i=1;i<7-lastDay.getDay();i++){
                var d=new Date(lastDay.getTime()+i*24*60*60*1000);
                dateArr.push({type:"next",date:d});
            }
            this.$datepicker.find(".header-date").text(this.watchDate.getFullYear()+"年"+(this.watchDate.getMonth()+1)+"月");
            var tp1="";
            for(var i=0;i<dateArr.length;i++){
                if(i%7==0){
                    tp1=tp1+"<tr>";
                }
                tp1+="<td class='";
                if(dateArr[i].type=="pre"){
                    tp1+="pre-month";
                }else if(dateArr[i].type=="cur"){
                    tp1+="cur-month";
                }else if(dateArr[i].type=="next"){
                    tp1+="next-month";
                }
                if(this.getYYMMDD(dateArr[i].date)===this.getYYMMDD(this.date)){
                    tp1+=" cur-date";
                }
                tp1+="'";
                tp1+="data-date='"+this.getYYMMDD(dateArr[i].date)+"'>";
                tp1+=dateArr[i].date.getDate()+"</td>";
                if(i%7==6){
                    tp1+="</tr>";
                }
            }
            this.$datepicker.find("tbody").html(tp1);
        },
        bind:function () {
            var self=this;
            this.$datepicker.find(".pre").on("click",function(){
                self.watchDate=self.getPreMonth(self.watchDate);
                self.setData();
            });
            this.$datepicker.find(".next").on("click",function(){
                self.watchDate=self.getNextMonth(self.watchDate);
                self.setData();
            });
            this.$datepicker.on("click",".cur-month",function () {
                self.$target.val($(this).attr("data-date"));
                self.$datepicker.hide();
            });
            this.$target.on("click",function (e) {
                e.stopPropagation();
                self.$datepicker.show();
            });
            this.$datepicker.on("click",function (e) {
                e.stopPropagation();
            });
            $(window).on("click",function (e) {
                self.$datepicker.hide();
            })

        },
        //得到这个月的第一天的时间对象
        getFirstDay:function (date) {
            var year=date.getFullYear(),
                month=date.getMonth();
            return new Date(year,month,1);
        },
        //得到这个月的最后一天的时间对象
        getLastDay:function (date) {
            var year=date.getFullYear(),
                month=date.getMonth()+1;
            if(month>11){
                month=0;
                year++;
            }
            var newDate=new Date(year,month,1);
            return new Date(newDate.getTime()-24*60*60*1000);
        },
        // 得到上个月1号的时间对象
        getPreMonth:function (date) {
            var year=date.getFullYear(),
                month=date.getMonth()-1;
            if(month<0){
                month=11;
                year--;
            }
            return new Date(year,month,1);
        },
        // 得到下个月1号的时间对象
        getNextMonth:function (date) {
            var year=date.getFullYear(),
                month=date.getMonth()+1;
            if(month>11){
                month=0;
                year++;
            }
            return new Date(year,month,1);
        },
        getYYMMDD:function (date) {
            return [date.getFullYear(),
                "/",
                date.getMonth()+1,
                "/",
                date.getDate()].join("");
        }

    };
    $.fn.datePicker=function () {
        this.each(function () {
            new DatePicker($(this));
        })
    };
    $(".date-ipt").datePicker();
</script>

</body>
</html>
